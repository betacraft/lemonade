(function(){"use strict";angular.module("lemonades",["ngCookies","ngResource","ngSanitize","ngRoute","angulartics","angulartics.google.analytics"]).run(function(a,b,c,d){return a.baseUrl="http://localhost:3000",a.loading=!1,a.getUser=function(){var b;return console.log("getting user"),b={method:"GET",url:a.baseUrl+"/api/v1/user",headers:{"Session-Key":d.get("lmnsskey")}},c(b).success(function(){}).error(function(){})},a.goToLogin=function(){return b.path("/login")}}).factory("myHttpInterceptor",function(a,b,c,d,e){return{request:function(a){return console.log("requesting",a),a.ignoreLoadingFlag||(c.loading=!0),a},requestError:function(b){return c.loading=!1,canRecover(b)?responseOrNewPromise:a.reject(b)},response:function(a){return c.loading=!1,a},responseError:function(b){var f;return c.loading=!1,f=b.status,401===f&&(console.log(d.pathname),e.remove("lmnsskey")),a.reject(b)}}}).config(function(a){return a.interceptors.push("myHttpInterceptor"),delete a.defaults.headers.common["X-Requested-With"],a.defaults.useXDomain=!0}).config(function(a,b){return a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/register",{templateUrl:"views/register.html",controller:"RegisterCtrl"}).when("/dashboard",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).when("/register/success",{templateUrl:"views/register/success.html",controller:"RegisterSuccessCtrl"}).when("/group/:id",{templateUrl:"views/group.html",controller:"GroupCtrl"}).when("/my-groups",{templateUrl:"views/my-groups.html",controller:"MyGroupsCtrl"}).otherwise({redirectTo:"/"}),b.html5Mode({enabled:!1,requireBase:!0}).hashPrefix()})}).call(this),function(){"use strict";angular.module("lemonades").controller("DashboardCtrl",function(a,b,c,d,e,f){return a.sessionKey=c.get("lmnsskey"),a.object={},a.pageNo=0,a.groups={},a.init=function(){return console.log(a.sessionKey),e.getUser(),a.getGroups()},a.landing=function(){return f.path("/")},a.myGroups=function(){return f.path("/my-groups")},a.goToGroup=function(a){return f.path("/group/"+a)},a.logout=function(){var b;return b={method:"POST",url:e.baseUrl+"/api/v1/user/logout",headers:{"Session-Key":a.sessionKey}},d(b).success(function(b){b.success&&(c.remove("lmnsskey"),console.log(b),a.sessionKey=null)}).error(function(a){})},a.getGroups=function(){var b;return b={method:"GET",url:e.baseUrl+"/api/v1/groups?page="+a.pageNo,headers:{"Session-Key":a.sessionKey}},d(b).success(function(b){if(b.success){if(console.log(b),null===b.groups)return void(a.pageNo=-1);0===a.pageNo?a.groups=b.groups:a.groups=a.groups.concat(b.groups),b.groups.length<9?a.pageNo=-1:a.pageNo+=1}}).error(function(a){})},a.createGroup=function(){var b,c;return b=$("#createGroup").button("loading"),c={method:"POST",url:e.baseUrl+"/api/v1/group",headers:{"Session-Key":a.sessionKey},data:a.object},d(c).success(function(c){return $("#createGroupModal").modal("hide"),b.button("reset"),c.success?(f.path("/group/"+c.group.id),void console.log(c)):a.status={message:c.message,success:!1}}).error(function(c){return b.button("reset"),a.status={message:c.message,success:!1}})}})}.call(this),function(){"use strict";angular.module("lemonades").controller("GroupCtrl",function(a,b,c,d,e,f,g){return a.sessionKey=c.get("lmnsskey"),a.groupId=f.id,a.group={},a.shareText="Buy electronic items in group with huge discounts #onlineshopping #lemonades",a.init=function(){return e.getUser()},a.login=function(){return g.path("/login")},a.joinGroup=function(){var b;return b={method:"POST",url:e.baseUrl+"/api/v1/group/"+a.groupId+"/join",headers:{"Session-Key":a.sessionKey}},d(b).success(function(b){b.success&&(console.log(b),a.group=b.group)}).error(function(a){})},a.logout=function(){var b;return b={method:"POST",url:e.baseUrl+"/api/v1/user/logout",headers:{"Session-Key":a.sessionKey}},d(b).success(function(b){b.success&&(c.remove("lmnsskey"),console.log(b),a.sessionKey=null)}).error(function(a){})},a.createGroup=function(){var b,c;return b=$("#createGroup").button("loading"),c={method:"POST",url:e.baseUrl+"/api/v1/group",headers:{"Session-Key":a.sessionKey},data:a.object},d(c).success(function(c){return b.button("reset"),$("#createGroupModal").modal("hide"),c.success?(g.path("/group/"+c.group.id),void console.log(c)):a.status={message:c.message,success:!1}}).error(function(c){return b.button("reset"),a.status={message:c.message,success:!1}})},a.dashboard=function(){return g.path("/dashboard")},a.init=function(){var b;return b={method:"GET",url:e.baseUrl+"/api/v1/group/"+a.groupId,headers:{"Session-Key":a.sessionKey}},d(b).success(function(b){return b.success?(console.log(b),a.group=b.group,void(a.shareText="Buy "+b.group.product.name+" with "+b.group.interested_users_count+" on lemonades.in")):a.status={message:b.message,success:!1}}).error(function(b){return a.status={message:b.message,success:!1}})}})}.call(this),function(){"use strict";angular.module("lemonades").controller("LoginCtrl",function(a,b,c,d,e,f){return a.user={},a.landing=function(){return e.path("/")},a.register=function(){return e.path("/register")},a.login=function(){var g;return console.log("login"),g=$("#loginButton").button("loading"),console.log("registering"),c.post(d.baseUrl+"/api/v1/user/login",a.user).success(function(c){return g.button("reset"),c.success?(console.log(c),f.store(c.user),b.put("lmnsskey",c.user.session_key,{expires:1,path:"/"}),void e.path("/dashboard")):a.status={message:c.message,success:!1}}).error(function(b){return g.button("reset"),a.status={message:b.message,success:!1}})}})}.call(this),function(){"use strict";angular.module("lemonades").controller("MainCtrl",function(a,b,c,d,e){return a.sessionKey=d.get("lmnsskey"),a.deals={},a.dashboard=function(){return b.path("/dashboard")},a.init=function(){return c.getUser(),a.getGroups()},a.goToGroup=function(a){return b.path("/group/"+a)},a.getGroups=function(){var b;return b={method:"GET",url:c.baseUrl+"/api/v1/groups",headers:{"Session-Key":a.sessionKey}},e(b).success(function(b){b.success&&(console.log(b),b.groups.length>6&&(a.groups=b.groups.slice(0,6)),b.groups.length<6&&(a.groups=b.groups))}).error(function(a){})},a.login=function(){return b.path("/login")},a.register=function(){return b.path("/register")},a.dashboard=function(){return b.path("/dashboard")}})}.call(this),function(){"use strict";angular.module("lemonades").controller("MyGroupsCtrl",function(a,b,c,d,e,f){return a.sessionKey=c.get("lmnsskey"),a.object={},a.pageNo=0,a.joinedGroupPageNo=0,a.createdGroups=[],a.joinedGroups=[],a.init=function(){return""===a.sessionKey?void f.path("/dashboard"):(console.log(a.sessionKey),a.getCreatedGroups(),a.getJoinedGroups())},a.landing=function(){return f.path("/")},a.allGroups=function(){return f.path("/dashboard")},a.goToGroup=function(a){return f.path("/group/"+a)},a.logout=function(){var b;return b={method:"POST",url:e.baseUrl+"/api/v1/user/logout",headers:{"Session-Key":a.sessionKey}},d(b).success(function(b){b.success&&(c.remove("lmnsskey"),f.path("/dashboard"),a.sessionKey=null)}).error(function(a){})},a.getCreatedGroups=function(){var b;return b={method:"GET",url:e.baseUrl+"/api/v1/user/groups/created?page="+a.pageNo,headers:{"Session-Key":a.sessionKey}},d(b).success(function(b){if(b.success){if(console.log(b),null===b.created_groups)return void(a.pageNo=-1);0===a.pageNo?a.createdGroups=b.created_groups:a.createdGroups=a.groups.concat(b.created_groups),b.created_groups.length<9?a.pageNo=-1:a.pageNo+=1}}).error(function(a){})},a.getJoinedGroups=function(){var b;return b={method:"GET",url:e.baseUrl+"/api/v1/user/groups/joined?page="+a.joinedGroupPageNo,headers:{"Session-Key":a.sessionKey}},d(b).success(function(b){if(b.success){if(console.log(b),null===b.joined_groups)return void(a.joinedGroupPageNo=-1);0===a.joinedGroupPageNo?a.joinedGroups=b.joined_groups:a.joinedGroups=a.groups.concat(b.joined_groups),b.joined_groups.length<9?a.joinedGroupPageNo=-1:a.joinedGroupPageNo+=1}}).error(function(a){})},a.createGroup=function(){var b,c;return b=$("#createGroup").button("loading"),c={method:"POST",url:e.baseUrl+"/api/v1/group",headers:{"Session-Key":a.sessionKey},data:a.object},d(c).success(function(c){return $("#createGroupModal").modal("hide"),b.button("reset"),c.success?(f.path("/group/"+c.group.id),void console.log(c)):a.status={message:c.message,success:!1}}).error(function(c){return b.button("reset"),a.status={message:c.message,success:!1}})}})}.call(this),function(){"use strict";angular.module("lemonades").controller("RegisterCtrl",function(a,b,c,d){return a.user={},a.landing=function(){return b.path("/")},a.login=function(){return b.path("/login")},a.register=function(){var e;return void 0===a.user.password?void(a.status={message:"Min length of password must be 8 characters",success:!1}):a.user.password!==a.user.confirm_password?void(a.status={message:"Passwords are not matching",success:!1}):(e=$("#signUpButton").button("loading"),console.log("registering"),c.post(d.baseUrl+"/api/v1/user",a.user).success(function(c){return e.button("reset"),a.status={},c.success?void b.path("/register/success"):a.status={message:c.message,success:!1}}).error(function(b){return e.button("reset"),a.status={message:b.message,success:!1}}))}})}.call(this),function(){"use strict";angular.module("lemonades").controller("RegisterSuccessCtrl",function(a,b){return a.landing=function(){return b.path("/")},a.dashboard=function(){return b.path("/dashboard")}})}.call(this);